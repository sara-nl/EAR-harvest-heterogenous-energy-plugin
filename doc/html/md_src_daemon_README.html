<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>EAR: Energy Aware Runtime: (Node) Daemon</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EAR
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Energy Aware Runtime: (Node) Daemon </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The node daemon is the component in charge of providing any kind of services that requires privileged capabilities. Current version is conceived as an external process executed with root privileges.</p>
<p>The EARD provides two basic services, each one covered by one thread:</p><ul>
<li>Provides privileged metrics such as average frequency, uncore integrated memory controller counters to compute the memory bandwidth, and also energy metrics (DC node, DRAM and package energy).</li>
<li>Implements a periodic power monitoring service. This service allows EAR package to control the total energy consumed in the system.</li>
</ul>
<h2>Requirements </h2>
<p>EARD uses CPUPower, FreeIPMI and PAPI (with RAPL component enabled). Paths to these libraries must be specified during the installation process when they are not installed in default paths.</p>
<p>When executed in production environments, EARD connects with ../database_cache/REAME.md "EARDBD" service, that has to be up before starting the node daemon, otherwise values reported by EARD to be stored in the database, will be lost.</p>
<h2>Configuration </h2>
<p>The EAR Daemon uses the <code>/ear.conf</code> file to be configured. It can be dynamically configured by reloading the service.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Fields related to the Daemon</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# Lines starting with # are comments</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;# Verbose level</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;NodeDaemonVerbose=1</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# Frequency used by power monitoring service (in seconds)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;NodeDaemonPowermonFreq=10</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# Maximum p_state supported (1 nominal)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;NodeDaemonMaxPstate=1</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;# Turbo frequencies supported (0 no)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;NodeDaemonTurbo=0</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;# Port to be used by the remote API</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;NodeDaemonPort=5000</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;# MySQL DB is used</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;NodeUseDB=1</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;# MySQL is used and records are sent using eardbd, otherwise EARD will send it directly to the MySQL server</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;NodeUseEARDBD=1</div></div><!-- fragment --><h2>Execution </h2>
<p>To execute this component, this <code>systemctl</code> command examples are provided:</p><ul>
<li><code>sudo systemctl start eard</code> to start the EARD service.</li>
<li><code>sudo systemctl stop eard</code> to stop the EARD service.</li>
<li><code>sudo systemctl reload eard</code> to force to reload the configuration of the EARD service.</li>
</ul>
<p>Log messages are generated during the execution. Use journalctl command to see eard message:</p>
<ul>
<li><code>sudo journalctl -u eard -f</code> to force to reload the configuration of the EARD service.</li>
</ul>
<h2>Reconfiguration </h2>
<p>After executing a "systemctl reload eard" command, not all the EARD options are dynamically updated. The list of updated variables are:</p>
<ul>
<li>NodeDaemonMaxPstate</li>
<li>NodeDaemonVerbose</li>
<li>Default policy and default policy settings</li>
<li>NodeDaemonPowermonFreq</li>
</ul>
<p>To reconfigure other detauils such as EARD port, coefficients, etc, EARD must be stopped and restarted again.</p>
<h2>API </h2>
<p>The (node) Daemon offers a simple API to request changes on the frequency, modify the current node settings, and reload the system configuration by reading <code>/ear.conf</code></p>
<p>Three APIs are provided:</p><ul>
<li>Local API, to be used by ../library/README.md "EARL" (or any other runtime). It can be found in <a href="eard_api.h">eard_api.h</a>. This API involves complex data types and is not public.</li>
<li>Local API, to be used by applications. It is a subset of the EARD api and designed to be used by any applications to contact the privileged metric service offered by EARD. This API is public and can be used without restrictinos, so doesn't include functions to change the frequency. It can be found at <a href=".">TBD</a>.</li>
<li>Remote API, to be used by the ../global_manager/README.md "EARGMD" or system commands and tools such as the <code>econtrol</code>. Can be found at <a href="eard_rapi.h">eard_rapi.h</a> and is not public.</li>
</ul>
<h2>Basic commands </h2>
<p>EARD includes some basic commands to be used in the same node eard is running. These commands change/get specific settings in the current node. They are not designaed to be used as system tools, just under development systems. We are offering:</p>
<ol type="1">
<li>Commands using the eard local api:<ul>
<li>commands/ear_get_node_freq: Usage: ./ear_get_node_freq num_cpus</li>
<li>commands/ear_set_ondemand: Usage:ear_set_ondemand cpus|[-h]. Changes the current governor to ondemand</li>
<li>commands/ear_set_node_freq: Usage: ear_set_node_freq node_freq (in MHz) num_cpus</li>
</ul>
</li>
<li>Commands using the remote api (can be connected from a different node) to notify new job/end job. They do the same functionality than EAR slurm plugin does<ul>
<li>commands/ear_new_job:Connects with eard and sends a new_job requests. It automatically reads ear.conf file and sets application details based on environment variables.Only needed when slurm is not installed.</li>
<li>commands/ear_end_job: Connects with eard and sends an end_job request. It automatically reads ear.conf file and sets application details based on environmen t variables. Only needed when slurm is not installed.</li>
</ul>
</li>
<li>Commands using the remote api (can be connected from a different node) to change node settings (defaul/max frequencies and th (for min_time))<ul>
<li>commands/ear_set_freq: usage:ear_set_freq new_freq (in KHz)</li>
<li>commands/ear_inc_th: usage:./ear_inc_th perc to be added to current PerformanceEfficiencyGain (5 means 5%)</li>
<li>commands/ear_red_freq: usage:./ear_red_freq p_states</li>
<li>commands/ear_set_th: usage:./ear_set_th MinPerformanceEfficiencyGain (75 means 0.75%)</li>
</ul>
</li>
</ol>
<h2>Daemon testing </h2>
<p>Look into the ../tests/README.md "EAR test folder"</p>
<h2>License </h2>
<p>All the files in the EAR framework are under the LGPLv2.1 license. See the <a href="../../COPYING">COPYING</a> file in the EAR root directory. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
