<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>EAR: EAR Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EAR
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">EAR Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The EAR library is the core of the EAR package. The EARL offers a ligthweigth and simple solution to select the optional frequency for MPI applications at runtime.</p>
<p>EARL is dynamically loaded with applications using the PMPI interface used by many other runtime solutions. The current EARL version only supports with this mechanism but it is under development an API to be inserted in the OpenMPI library.</p>
<p>At runtime, EARL goes trough the following phase:</p>
<div class="image">
<img src="../../etc/images/EAR_stack.png"  align="right" width="280"/>
</div>
<ol type="1">
<li>Automatic detection of application outer loops. This is done by dynamically intercepting MPI calls (using LD_PRELOAD) and invoking DynAIS algorithm, our Dynamic Application Iterative Structure detector algorithm. DynAIS is highly optimized for new Intel architectures reporting low overhead.</li>
<li>Computation of the application signature. Once DynAIS starts reporting iterations for the outer loop, EAR starts computing the application signature. This signature includes: CPI, iteration time, DC node power and TPI (transactions per instruction). Since DC node power measurements error highly depends on the hardware, EAR automatically detects the hardware characteristics and sets a minimum time to compute the signature in order to minimize the average error.</li>
</ol>
<div class="image">
<img src="../../etc/images/Models.png"  align="centered" width="640"/>
</div>
<ol type="1">
<li>Power and performance projection. EAR has its own performance and power models which uses, as an input, the application signature and the system signature. The system signature is a set of coefficients characterizing each node in the system. They are computed at the learning phase at the EAR configuration time. EAR projects the power used and computing time (performance) of the running application for all the available frequencies in the system.</li>
</ol>
<div class="image">
<img src="../../etc/images/Projections.png"  align="centered" width="640"/>
</div>
<ol type="1">
<li>Apply the selected power policy. EAR includes two power policies to be selected at runtime: 'minimize time to solution' and 'minimize energy to solution'. These policies are permitted or not by the system administrator. At this point, EAR executes the power policy, using the projections computed in the previous phase, and selects the optimal frequency for this application and this particular run.</li>
</ol>
<h2>Configuration </h2>
<p>The EAR Library is based on ear.conf settings when executing in a fully installed environment. Specific settings are available through a shared memory regions initialized by EARD and readable by the EARL. Fields described in ear.conf affecting the EARL configuration are (lines starting with #are comments):</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Number of levels used by the multi-level DynAIS algorihtm</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;DynAISLevels=4</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;# Windows size for DynAIS algorithm</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;DynAISWindowSize=500</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# Maximum time (in seconds) EAR will wait until a signature is computed. After DynaisTimeout seconds, if no signature is computed, EAR will go to periodic mode</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;DynaisTimeout=30</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# When EAR goes to periodic mode, it will compute the Application signature every &quot;LibraryPeriod&quot; seconds</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;LibraryPeriod=30</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;# EAR will check every N mpi calls whether it must go to periodic mode or not</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;CheckEARModeEvery=1000</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;# Default policy</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;DefaultPowerPolicy=MIN_TIME_TO_SOLUTION</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;# List of supported policies for normal users: it must be a subset of MONITORING_ONLY,MIN_TIME_TO_SOLUTION,MIN_ENERGY_TO_SOLUTION</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;SupportedPolicies=MONITORING_ONLY,MIN_TIME_TO_SOLUTION,MIN_ENERGY_TO_SOLUTION</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;# Pstates must be specified in the following order:MIN_ENERGY_TO_SOLUTION,MIN_TIME_TO_SOLUTION,MONITORING_ONLY </div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;DefaultPstates=1,4,4</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;# Thresholds used by MIN_TIME_TO_SOLUTION and MIN_ENERGY_TO_SOLUTION policies</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;MinEfficiencyGain=0.7</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;MaxPerformancePenalty=0.1</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;# Time (expressed in usecs ) used between two energy measurements </div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;MinTimePerformanceAccuracy=10000000</div></div><!-- fragment --><ul>
<li>When executed in a partially installed system for testing, it can be configured through environment variables, however this mechanism is not recommened.</li>
</ul>
<h2>How to run MPI applications with EARL </h2>
<p>To load EARL with MPI jobs, it is only required to set the LD_PRELOAD environment variable with the EAR library binary 'libear.so' path name, before your application starts. EARL will be loaded at runtime and MPI calls will be intercepted calling EAR API automatically. To simplify the execution of applications with EARL, we include a SLURM SPANK plugin, which extends srun options.</p>
<h2>EAR with SLURM plugin </h2>
<p>Even though EAR doesn't need SLURM tobe executed, this is the recommended option since it makes totally transparent the execution of jobs with EAR. The plugin will deal with the configuration of the application and will contact the EARD and EAR Global Manager.</p>
<p>EAR library can be configured by the system administrator to be loaded "by default" or not. When EAR is configured by default, it is not needed to add any option to srun or sbatch. If EAR is disables by default, users can enable it by using some of the ear options or just adding <code>--ear=on</code> , in that case, default configuration will be loaded. For a complete list of parameters, please visit the ../slurm_plugin/README.md "SLURM plugin page"</p>
<p>For example: <code>./srun -N2 -n2 --ear=on application</code> &ndash;&gt; will run application with EAR library with default configuration (defined by sysadmin) For example: <code>./srun -N2 -n2 --ear-policy=MIN_ENERGY_TO_SOLUTION application</code> &ndash;&gt; will run application with EAR library and will select MIN_ENERGY_TO_SOLUTION power policy. If the user is not allowed to use this policy, the default settings will be applied</p>
<p>If your application is not an MPI application, the benefits of the EAR library won't be applied. But the SLURM plugin would contact with the daemons in order to monitorize the application metrics and take a decision in case the energy budget is surpassed.</p>
<h2>Launching applications calling MPI directly </h2>
<p>This way doesn't make use of any cluster job scheduler, so a a script is provided to make it easy that task. You can launch the script with empty parameters to view it's usage.</p>
<p>In the folder <code>/scripts/launching</code>, execute the <code>mpi_exec.sh</code> script to launch the job. In example <code>./mpi_exec.sh computing_node1 28 28 MONITORING_ONLY</code>, where both numbers are the MPI processes and the MPI's per node, an the last one is the policy. This is script will use the <code>LD_PRELOAD</code> environment variable to load the library next to your MPI applications.</p>
<h2>License </h2>
<p>All the files in the EAR framework are under the LGPLv2.1 license. See the <a href="../../COPYING">COPYING</a> file in the EAR root directory. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
