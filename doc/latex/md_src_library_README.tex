The E\+AR library is the core of the E\+AR package. The E\+A\+RL offers a ligthweigth and simple solution to select the optional frequency for M\+PI applications at runtime.

E\+A\+RL is dynamically loaded next to the running applications using the P\+M\+PI interface, which it\textquotesingle{}s used by many other runtime solutions. The current E\+A\+RL version only supports this mechanism but it is under development an A\+PI to be inserted in the Open\+M\+PI library.

At runtime, E\+A\+RL goes through the following phase\+:




\begin{DoxyEnumerate}
\item Automatic detection of application outer loops. This is done by dynamically intercepting M\+PI calls (using {\ttfamily L\+D\+\_\+\+P\+R\+E\+L\+O\+AD}) and invoking the Dynamic Application Iterative Structure detector algorithm. Dyn\+A\+IS is highly optimized for new Intel architectures reporting low overhead.
\item Computation of the application signature. Once Dyn\+A\+IS starts reporting iterations for the outer loop, E\+AR starts computing the application signature. This signature includes\+: iteration time, DC power consumption, C\+PI and T\+PI (transactions per instruction). Since DC power measurements error highly depends on the hardware, E\+AR automatically detects the hardware characteristics and sets a minimum time to compute the signature in order to minimize the average error.
\end{DoxyEnumerate}




\begin{DoxyEnumerate}
\item Power and performance projection. E\+AR has its own performance and power models which requires as an input, the application and the system signatures. The system signature is a set of coefficients characterizing each node in the system. They are computed at the learning phase at the E\+AR configuration time. E\+AR projects the power used and computing time (performance) of the running application for all the available frequencies in the system.
\end{DoxyEnumerate}




\begin{DoxyEnumerate}
\item Apply the selected power policy. E\+AR includes two power policies to be selected at runtime\+: \textquotesingle{}minimize time to solution\textquotesingle{} and \textquotesingle{}minimize energy to solution\textquotesingle{} if are permitted by the system administrator. At this point, E\+AR executes the power policy, using the projections computed in the previous phase, and selects the optimal frequency for this application and this particular run.
\end{DoxyEnumerate}

\subsection*{Configuration }

The E\+AR Library uses the {\ttfamily /ear.conf} file to be configured. Please visit the ../../etc/conf/\+R\+E\+A\+D\+ME.md \char`\"{}\+E\+A\+R configuration file page\char`\"{} for more information about the options of E\+A\+RL and other components.

The library receives the its specific settings through a shared memory regiones initialized by E\+A\+RD.

\subsection*{How to run M\+PI applications with E\+A\+RL }

To load E\+A\+RL with M\+PI jobs, it is only required to set the {\ttfamily L\+D\+\_\+\+P\+R\+E\+L\+O\+AD} environment variable with the library binary \textquotesingle{}libear.\+so\textquotesingle{} path name, before your application starts. E\+A\+RL will be loaded at runtime and M\+PI calls will be intercepted calling E\+AR A\+PI automatically.

To use this feature you have to rely on S\+L\+U\+RM plugin. Check the ../slurm\+\_\+plugin/\+R\+E\+A\+D\+ME.md \char`\"{}\+E\+A\+R S\+L\+U\+R\+M plugin page\char`\"{} for information about all the S\+L\+U\+RM arguments. The plugin will deal with the configuration of the application and will contact the E\+A\+RD and E\+AR Global Manager.

The library can be configured by the system administrator to be loaded by default or not. When E\+AR is configured by default, it is not needed to add any option to {\ttfamily srun} nor {\ttfamily sbatch}. If E\+AR is disabled by default, users can enable it by using the argument {\ttfamily -\/-\/ear=on} .

The following example will run application with E\+AR library with default configuration (defined by sysadmin)\+:

{\ttfamily ./srun -\/\+N2 -\/n2 -\/-\/ear=on application}

Also, the following example will run application with E\+AR library and will select M\+I\+N\+\_\+\+E\+N\+E\+R\+G\+Y\+\_\+\+T\+O\+\_\+\+S\+O\+L\+U\+T\+I\+ON power policy. If the user is not allowed to use this policy, the default settings will be applied\+:

{\ttfamily ./srun -\/\+N2 -\/n2 -\/-\/ear-\/policy=M\+I\+N\+\_\+\+E\+N\+E\+R\+G\+Y\+\_\+\+T\+O\+\_\+\+S\+O\+L\+U\+T\+I\+ON application}

If your application is not an M\+PI application, the benefits of the E\+AR library won\textquotesingle{}t be applied. But the S\+L\+U\+RM plugin would contact with the daemons in order to monitorize the application metrics and take a decision in case the energy budget is surpassed.

\subsection*{License }

All the files in the E\+AR framework are under the L\+G\+P\+Lv2.\+1 license. See the \href{../../COPYING}{\tt C\+O\+P\+Y\+I\+NG} file in the E\+AR root directory. 