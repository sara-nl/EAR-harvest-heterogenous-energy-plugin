CFLAGS = -I../.. -fPIC -axCORE-AVX512 -O2
CFLAGS = -I../.. -fPIC -xHost -O2
CFLAGS = -I../.. -I/hpc/opt/papi/include -fPIC -O3
CFLAGS = -I../.. -fPIC -O2
LDFLAGS = -L/hpc/opt/papi/lib -Wl,-rpath,/hpc/opt/papi/lib -lpapi
CC = /hpc/opt/intel/compilers_and_libraries_2017.7.259/linux/bin/intel64/icc
CC = icc

########

all: string_enhanced.o dynais_core.o main
#all: dynais_short.o

%.o: %.c %.h
	$(CC) $(CFLAGS) -march=native -c $< 
#	$(CC) $(CFLAGS) -S $<

dynais_core.o:
	$(CC) $(CFLAGS) -DDYN_CORE_N              -march=native -o dynais_core_n.o -c dynais_core.c
	$(CC) $(CFLAGS) -DDYN_CORE_0              -march=native -o dynais_core_0.o -c dynais_core.c
	$(CC) $(CFLAGS) -DDYN_CORE_0 -DDYN_CORE_F -march=native -o dynais_old.o -c dynais_old.c
	$(CC) $(CFLAGS)                           -march=native -c dynais.c


string_enhanced.o: ../../common/string_enhanced.c ../../common/string_enhanced.h
	$(CC) $(CFLAGS) -c $<

main: main.c
	$(CC) $(CFLAGS)             -march=native -o maino main.c dynais_old.o string_enhanced.o ../../metrics/libmetrics.a $(LDFLAGS)
	$(CC) $(CFLAGS) -DEAR_SHORT -march=native -o mainc main.c dynais.o dynais_core_n.o dynais_core_0.o string_enhanced.o ../../metrics/libmetrics.a $(LDFLAGS)
#	$(CC) $(CFLAGS) -march=native -o main main.c dynais_int.o string_enhanced.o

######## OPTIONS

clean:
	rm -f *.o *.a *.so mainl mains mainc main

######## DEPENDENCIES

#include $(SRCDIR)/Makefile.depend
