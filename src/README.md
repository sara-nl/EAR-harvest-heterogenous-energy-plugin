Main components description
---------------------------
EAR is composed by four main components: EAR Library, EAR (node) Daemon, EAR Global Manager Daemon, and EAR Database Daemon.

The EAR Library ([EARL](./library/README.md)) and EAR Daemon ([EARD](./daemon/README.md)) together are the core of the EAR package.

The EAR Library interceps the Profiling MPI Interface (PMPI) symbols using the dynamic loader environment variable LD_PRELOAD. The intercepted call allows the powerfull DynAIS algorithm to detect the tipical repetitive sequences of code found in the regular HPC applications. Once found a new repetitive sequence, metrics like CPI, bandwith and power are calculated.

This data allows the library to predict the best frequency for the selected power policy for the upcoming iterations, setting then the proper CPU clock. I.e, if a detected bucle iteration is memory intensive, setting lower clocks holds the performance but saves a lot of power consumption. Because of that, the CPU frequency is constantly switching, maximizing the efficiency of the cluster.

The EAR (node) Daemon allows the library to use some of the privileged functions like switching the core frequency.

 To provide good predictions, it's used a performance and power models, which gets as an input the system and the application signature.

The system signature has a form of coefficients and it's computed once (at installation time). This process is called learning phase and consist in the execution of a set of pre-selected stressing benchmarks included in the package distribution. The application signature is computed at runtime since it characterizes the application

The EAR Global Manager Daemon ([EARGMD](./global_manager/README.md)) is a step beyond than only a single library. All the HPC clusters must control the energy consumed and, moreover, some others have limitations beacuse of the infrastructure (or will have limitations). The EAR Global Manager can be used in **passive** mode or **active** mode.

When configured in passive mode, the EARGM will monitor the energy consumed in the system reporting warnings to the EAR DB or simple actions (such as sending mails). When configured in active mode, the EARGM will automatically react to energy warnings detected. The current EARGM only supports predefined levels and actions in automatic mode but we are working in a new version where different levels and actions will be configured through the `ear.conf` file (or a similar approach)

The EAR Database Daemon ([EARDBD](./database_cache/README.md)) includes a MySQL data base and a several EAR Datatabase daemon (EARDBD) in charge of collect records generated by EARL and EARD in the system and report it to the centralized DB. Several EARDBD's will run in the system reducing the number of connections and messages to the EAR DB and providing aggregated metrics for some of the records.

Finally, the [EAR SLURM Plugin](./slurm_plugin/README.md), a lesser component which helps to connect all the main components focusing in the ease of use.

EAR source directories
---------------------------

| Directory      | Content                                        |
| -------------- | ---------------------------------------------- |
| library        | EAR Library                                    |
| database_cache | EAR Database                                   |
| daemon         | EAR (node) Daemon                              |
| global_manager | EAR Global Manager                             |
| commands       | Basic commands to get the metrics already reported by EAR in the DB, orchange cluster and node power      |
| slurm_plugin   | EAR SLURM Plugin, which simplifies the execution of the EAR Library next to an MPI application         |
| tools          | Additional programs used during the learning phase                                                           |
| tests          | Programs to test the installation and runtime of the components                                               |
| metrics        | Low level metric gathering functions           |
| common         | Generic functions and types                    |
