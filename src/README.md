EAR components
---------------------------
EAR is composed by four main components: EAR Library, EAR (node) Daemon, EAR Global Manager Daemon, and EAR Database Daemon. The EAR Library ([EARL](./library/README.md)) and EAR Daemon ([EARD](./daemon/README.md)) together are the core of the EAR package.

## EAR library 

The EAR Library interceps the Profiling MPI Interface (PMPI) symbols using the dynamic loader environment variable `LD_PRELOAD`.

Each intercepted call executes the DynAIS algorithm to detect the tipical repetitive sequences of code found in the regular HPC applications. Once found a new repetitive sequence, metrics like CPI, memory bandwidth and node power consumption are calculated.

This data, called the **application signature**, together with the node characterization, called the **system signature**,  allows the library to predict the performance (time) and power consumption
 for an iteration of a repetitive sequence for the list of available frequencies.

Given the predictions and the power policy, the *best* CPU frequency is selected. For instance, given an application with a memory intensive behavior, EARL will:
1) Detect dynamically the iterative section for the application.
2) Compute the application signature.
3) Apply perforance and power models.
4) Apply the power policy.
5) And finally, select and change the CPU frequency. In that kind of applications, reducing the CPU frequency will not significantly affect the application performance.

The system signature is a set of coefficients and it's computed once at configuration time. The process of computing the system signature is called the **learning phase**. It consist in the execution of a set of pre-selected stressing benchmarks included in the package distribution. The application signature is computed at runtime since it characterizes the application.

## EAR (node) Daemon

EAR Daemon ([EARD](./daemon/README.md)) is a daemon running in all the compute nodes. It is a core component and It provides three types of services: access to privileged metrics, periodic power monitoring and power control commands.

EARD is used by the library to read those metrics that requires root privileges. It also offers a simplified API to be used by applications. This API only provides the reading of the metrics (not control operations such as changing the frequency).

Moreover, each EARD is continuosly monitoring the node  and reporting information to the DB through the EARDBD. This information is used later by the EAR Global Manager.

Finally, EARD offers a privileged API to change power policy settings.

## EAR Global Manager

The EAR Global Manager Daemon ([EARGMD](./global_manager/README.md)) is a step beyond than the original daemon and library package. All the HPC clusters must control the energy consumed and, moreover, some others have limitations beacuse of the infrastructure. The EAR Global Manager can be used in **passive** mode or **active** mode.

When configured in passive mode, the EARGMD will monitor the energy consumed in the system, reporting warnings to the database or performing simple actions such as sending mails).

When configured in active mode, the EARGMD will automatically react to energy warnings detected. The current EARGMD only supports predefined levels and actions in automatic mode, but a new version where different levels and actions will be configured through the `ear.conf` file (or a similar approach) is being developed.

## EAR Database daemon

The EAR Database Daemon ([EARDBD](./database_cache/README.md)) collects records generated by EARL and EARD and reports them to the centralized database. Few EARDBD's will run in the cluster reducing the number of inserts to the database and providing aggregated metrics for some of the records.

## EAR SLURM plugin

Finally, the [EAR SLURM plugin](./slurm_plugin/README.md), a lesser component which helps to connect all the main components focusing in the ease of use. It is a SLURM SPANK type plugin, extending the `run` and `sbatch` options.